{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport { RNSharedElementStyle } from \"./RNSharedElementStyle\";\nimport { RNSharedElementContent } from \"./RNSharedElementContent\";\nimport { Rect } from \"./Rect\";\nexport var RNSharedElementNode = function () {\n  function RNSharedElementNode(domNode, isParent, ancestorDomNode) {\n    _classCallCheck(this, RNSharedElementNode);\n\n    this.hideRefCount = 0;\n    this.hideOpacity = 0;\n    this.refCount = 1;\n    this.styleCache = null;\n    this.styleCallbacks = null;\n    this.contentCache = null;\n    this.contentCallbacks = null;\n    this.domNode = domNode;\n    this.isParent = isParent;\n    this.ancestorDomNode = ancestorDomNode;\n  }\n\n  _createClass(RNSharedElementNode, [{\n    key: \"addRef\",\n    value: function addRef() {\n      return ++this.refCount;\n    }\n  }, {\n    key: \"releaseRef\",\n    value: function releaseRef() {\n      return --this.refCount;\n    }\n  }, {\n    key: \"addHideRef\",\n    value: function addHideRef() {\n      this.hideRefCount++;\n\n      if (this.hideRefCount === 1) {\n        var element = this.resolvedElement;\n        this.hideOpacity = element.style.opacity;\n        element.style.opacity = 0;\n      }\n    }\n  }, {\n    key: \"releaseHideRef\",\n    value: function releaseHideRef() {\n      this.hideRefCount--;\n\n      if (this.hideRefCount === 0) {\n        var element = this.resolvedElement;\n        element.style.opacity = this.hideOpacity;\n      }\n    }\n  }, {\n    key: \"requestStyle\",\n    value: function requestStyle() {\n      var _this = this;\n\n      if (this.styleCache) {\n        return Promise.resolve(this.styleCache);\n      }\n\n      return new Promise(function (resolve) {\n        _this.styleCallbacks = _this.styleCallbacks || [];\n\n        _this.styleCallbacks.push(resolve);\n\n        if (!_this.fetchInitialStyle()) {\n          console.debug('Failed to fetch style');\n        }\n      });\n    }\n  }, {\n    key: \"fetchInitialStyle\",\n    value: function fetchInitialStyle() {\n      var element = this.resolvedElement;\n      var ancestor = this.resolvedAncestor;\n      if (!element || !ancestor) return false;\n      if (!this.styleCallbacks) return true;\n      var rect = element.getBoundingClientRect();\n      var ancestorRect = ancestor.getBoundingClientRect();\n      var translateX = ancestorRect.x;\n      var translateY = ancestorRect.y;\n      var layout = new Rect({\n        x: rect.x - translateX,\n        y: rect.y - translateY,\n        width: rect.width,\n        height: rect.height\n      });\n      var style = new RNSharedElementStyle(layout, window.getComputedStyle(element, null));\n      this.styleCache = style;\n      var callbacks = this.styleCallbacks;\n      this.styleCallbacks = null;\n      callbacks.forEach(function (callback) {\n        return callback(style);\n      });\n      return true;\n    }\n  }, {\n    key: \"requestContent\",\n    value: function requestContent() {\n      var _this2 = this;\n\n      return _regeneratorRuntime.async(function requestContent$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (!this.contentCache) {\n                _context.next = 2;\n                break;\n              }\n\n              return _context.abrupt(\"return\", this.contentCache);\n\n            case 2:\n              return _context.abrupt(\"return\", new Promise(function (resolve) {\n                if (_this2.contentCallbacks) return;\n                _this2.contentCallbacks = _this2.contentCallbacks || [];\n\n                _this2.contentCallbacks.push(resolve);\n\n                _this2.fetchInitialContent();\n              }));\n\n            case 3:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, this);\n    }\n  }, {\n    key: \"fetchInitialContent\",\n    value: function fetchInitialContent() {\n      var element, size, content, callbacks;\n      return _regeneratorRuntime.async(function fetchInitialContent$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              element = this.resolvedElement;\n\n              if (element) {\n                _context2.next = 3;\n                break;\n              }\n\n              return _context2.abrupt(\"return\", false);\n\n            case 3:\n              if (this.contentCallbacks) {\n                _context2.next = 5;\n                break;\n              }\n\n              return _context2.abrupt(\"return\", true);\n\n            case 5:\n              _context2.next = 7;\n              return _regeneratorRuntime.awrap(RNSharedElementContent.getSize(element));\n\n            case 7:\n              size = _context2.sent;\n\n              if (size) {\n                _context2.next = 10;\n                break;\n              }\n\n              return _context2.abrupt(\"return\", false);\n\n            case 10:\n              content = new RNSharedElementContent(element, size);\n              this.contentCache = content;\n              callbacks = this.contentCallbacks;\n              this.contentCallbacks = null;\n              callbacks.forEach(function (callback) {\n                return callback(content);\n              });\n              return _context2.abrupt(\"return\", true);\n\n            case 16:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, null, this);\n    }\n  }, {\n    key: \"resolvedElement\",\n    get: function get() {\n      var element = this.domNode;\n\n      if (this.isParent) {\n        if (element.childNodes.length === 1) {\n          element = element.childNodes[0];\n        } else if (element.childNodes.length <= 0) {\n          console.log('Child for parent doesnt exist');\n          return null;\n        }\n      }\n\n      var _element = element,\n          childNodes = _element.childNodes;\n\n      if (childNodes.length === 2) {\n        for (var i = 0; i < 2; i++) {\n          var childNode = childNodes[i];\n\n          if (childNode.tagName === 'IMG') {\n            element = childNodes[i ? 0 : i + 1];\n            break;\n          }\n        }\n      }\n\n      return element;\n    }\n  }, {\n    key: \"resolvedAncestor\",\n    get: function get() {\n      return this.ancestorDomNode;\n    }\n  }]);\n\n  return RNSharedElementNode;\n}();","map":{"version":3,"sources":["RNSharedElementNode.ts"],"names":["RNSharedElementNode","hideRefCount","hideOpacity","refCount","styleCache","styleCallbacks","contentCache","contentCallbacks","element","console","childNodes","i","childNode","Promise","ancestor","rect","ancestorRect","translateX","translateY","layout","x","y","width","height","style","window","callbacks","callback","size","RNSharedElementContent","content"],"mappings":"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","sourcesContent":["import { RNSharedElementStyle } from './RNSharedElementStyle';\nimport { RNSharedElementContent } from './RNSharedElementContent';\nimport { Rect } from './Rect';\nimport { IHTMLElement } from './types';\n\nexport type RNSharedElementNodeStyleCallback = (\n  value: RNSharedElementStyle\n) => void;\nexport type RNSharedElementNodeContentCallback = (\n  value: RNSharedElementContent\n) => void;\n\nexport class RNSharedElementNode {\n  public readonly domNode: IHTMLElement;\n  public readonly ancestorDomNode: IHTMLElement;\n  public readonly isParent: boolean;\n  private hideRefCount: number = 0;\n  private hideOpacity: number = 0;\n  private refCount: number = 1;\n  private styleCache: RNSharedElementStyle | null = null;\n  private styleCallbacks: RNSharedElementNodeStyleCallback[] | null = null;\n  private contentCache: RNSharedElementContent | null = null;\n  private contentCallbacks: RNSharedElementNodeContentCallback[] | null = null;\n\n  constructor(\n    domNode: IHTMLElement,\n    isParent: boolean,\n    ancestorDomNode: IHTMLElement\n  ) {\n    this.domNode = domNode;\n    this.isParent = isParent;\n    this.ancestorDomNode = ancestorDomNode;\n  }\n\n  addRef() {\n    return ++this.refCount;\n  }\n\n  releaseRef() {\n    return --this.refCount;\n  }\n\n  addHideRef() {\n    this.hideRefCount++;\n    if (this.hideRefCount === 1) {\n      const element = this.resolvedElement;\n      this.hideOpacity = element!.style.opacity;\n      element!.style.opacity = 0;\n    }\n  }\n\n  releaseHideRef() {\n    this.hideRefCount--;\n    if (this.hideRefCount === 0) {\n      const element = this.resolvedElement;\n      element!.style.opacity = this.hideOpacity;\n    }\n  }\n\n  get resolvedElement(): IHTMLElement | null {\n    let element: IHTMLElement = this.domNode;\n\n    // If this node is a parent, look for the first child\n    if (this.isParent) {\n      if (element.childNodes.length === 1) {\n        element = element.childNodes[0];\n      } else if (element.childNodes.length <= 0) {\n        console.log('Child for parent doesnt exist');\n        return null;\n      }\n    }\n\n    // Get background-image node\n    const { childNodes } = element;\n    if (childNodes.length === 2) {\n      for (let i = 0; i < 2; i++) {\n        const childNode = childNodes[i];\n        if (childNode.tagName === 'IMG') {\n          element = childNodes[i ? 0 : i + 1];\n          break;\n        }\n      }\n    }\n\n    return element;\n  }\n\n  get resolvedAncestor(): IHTMLElement | null {\n    return this.ancestorDomNode;\n  }\n\n  requestStyle(): Promise<RNSharedElementStyle> {\n    if (this.styleCache) {\n      return Promise.resolve(this.styleCache);\n    }\n    return new Promise(resolve => {\n      this.styleCallbacks = this.styleCallbacks || [];\n      this.styleCallbacks.push(resolve);\n      if (!this.fetchInitialStyle()) {\n        console.debug('Failed to fetch style');\n        //startRetryLoop();\n      }\n    });\n  }\n\n  private fetchInitialStyle(): boolean {\n    const element = this.resolvedElement;\n    const ancestor = this.resolvedAncestor;\n    if (!element || !ancestor) return false;\n    if (!this.styleCallbacks) return true;\n\n    // Fetch layout\n    const rect = element.getBoundingClientRect();\n    // const ancestorTransform = ancestor.style.transform;\n    const ancestorRect = ancestor.getBoundingClientRect();\n    // console.log(\"ancestorTransform: \", ancestor.style, ancestorRect);\n    const translateX = ancestorRect.x; // TODO\n    const translateY = ancestorRect.y; // TODO\n    const layout = new Rect({\n      x: rect.x - translateX,\n      y: rect.y - translateY,\n      width: rect.width,\n      height: rect.height,\n    });\n\n    // Create style\n    const style = new RNSharedElementStyle(\n      layout,\n      // @ts-ignore\n      window.getComputedStyle(element, null)\n    );\n\n    // console.debug(\"Style fetched: \", style);\n\n    // Update cache\n    this.styleCache = style;\n\n    // Notify callbacks\n    const callbacks = this.styleCallbacks;\n    this.styleCallbacks = null;\n    callbacks.forEach(callback => callback(style));\n    return true;\n  }\n\n  async requestContent(): Promise<RNSharedElementContent> {\n    if (this.contentCache) return this.contentCache;\n\n    return new Promise(resolve => {\n      if (this.contentCallbacks) return;\n      this.contentCallbacks = this.contentCallbacks || [];\n      this.contentCallbacks.push(resolve);\n      this.fetchInitialContent();\n      // TODO RETRY IN CASE OF FAILURE?\n    });\n  }\n\n  private async fetchInitialContent(): Promise<boolean> {\n    const element = this.resolvedElement;\n    if (!element) return false;\n    if (!this.contentCallbacks) return true;\n\n    // Fetch content size\n    const size = await RNSharedElementContent.getSize(element);\n    if (!size) {\n      return false;\n    }\n\n    // Create content\n    const content = new RNSharedElementContent(element, size);\n\n    // console.debug(\"Content fetched: \", content);\n\n    // Update cache\n    this.contentCache = content;\n\n    // Notify callbacks\n    const callbacks = this.contentCallbacks;\n    this.contentCallbacks = null;\n    callbacks.forEach(callback => callback(content));\n    return true;\n  }\n}\n"]},"metadata":{},"sourceType":"module"}